/* ═══════════════════════════════════════════════════
   TIRREXBOARD — Modern Whiteboard
   Inter + JetBrains Mono · Glass · Responsive
═══════════════════════════════════════════════════ */

/* ── DESIGN TOKENS (Light) ── */
:root {
  --canvas:         #f4f4f8;
  --surface:        rgba(255,255,255,0.78);
  --surface-solid:  #ffffff;
  --surface-hover:  rgba(0,0,0,0.035);
  --surface-active: rgba(0,0,0,0.065);
  --border:         rgba(0,0,0,0.07);
  --border-strong:  rgba(0,0,0,0.12);
  --text:           #16161a;
  --text-dim:       #5a5a66;
  --text-faint:     #9d9daa;
  --accent:         #5b5cf0;
  --accent-rgb:     91, 92, 240;
  --accent-light:   rgba(91,92,240,0.09);
  --accent-hover:   rgba(91,92,240,0.16);
  --accent-glow:    rgba(91,92,240,0.25);
  --danger:         #ef4444;
  --danger-bg:      rgba(239,68,68,0.08);
  --warn:           #f59e0b;
  --success:        #10b981;
  --thumb-bg:       #f0f0f4;
  --thumb-border:   rgba(0,0,0,0.08);
  --blur:           16px;
  --shadow-xs:      0 1px 2px rgba(0,0,0,0.04);
  --shadow-sm:      0 1px 4px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.03);
  --shadow:         0 4px 20px rgba(0,0,0,0.07), 0 1px 5px rgba(0,0,0,0.04);
  --shadow-lg:      0 16px 48px rgba(0,0,0,0.1), 0 4px 14px rgba(0,0,0,0.05);
  --radius-xs:      4px;
  --radius-sm:      6px;
  --radius:         10px;
  --radius-lg:      14px;
  --radius-xl:      18px;
  --toolbar-w:      54px;
  --topbar-h:       46px;
  --spring:         cubic-bezier(0.34, 1.56, 0.64, 1);
  --ease:           cubic-bezier(0.16, 1, 0.3, 1);
  --font:           'Inter', -apple-system, 'Segoe UI', system-ui, sans-serif;
  --mono:           'JetBrains Mono', 'Fira Code', monospace;
  --gradient:       linear-gradient(135deg, #5b5cf0 0%, #8b5cf6 50%, #c084fc 100%);
}

/* ── DARK THEME ── */
body.dark {
  --canvas:         #0c0c10;
  --surface:        rgba(20,20,28,0.78);
  --surface-solid:  #161620;
  --surface-hover:  rgba(255,255,255,0.045);
  --surface-active: rgba(255,255,255,0.075);
  --border:         rgba(255,255,255,0.06);
  --border-strong:  rgba(255,255,255,0.10);
  --text:           #ededf0;
  --text-dim:       #8888a0;
  --text-faint:     #4e4e5e;
  --accent:         #7c7cf8;
  --accent-rgb:     124, 124, 248;
  --accent-light:   rgba(124,124,248,0.10);
  --accent-hover:   rgba(124,124,248,0.18);
  --accent-glow:    rgba(124,124,248,0.22);
  --danger-bg:      rgba(239,68,68,0.12);
  --thumb-bg:       rgba(255,255,255,0.035);
  --thumb-border:   rgba(255,255,255,0.06);
  --shadow-xs:      0 1px 2px rgba(0,0,0,0.3);
  --shadow-sm:      0 1px 4px rgba(0,0,0,0.35);
  --shadow:         0 4px 20px rgba(0,0,0,0.45), 0 1px 5px rgba(0,0,0,0.25);
  --shadow-lg:      0 16px 48px rgba(0,0,0,0.65), 0 4px 14px rgba(0,0,0,0.35);
}

/* ── RESET ── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
  font-family: var(--font);
  background: var(--canvas);
  color: var(--text);
  overflow: hidden;
  width: 100%; height: 100%;
  user-select: none;
  -webkit-user-select: none;
  transition: background 0.35s ease, color 0.35s ease;
  -webkit-tap-highlight-color: transparent;
}

/* ═══════════════════════════════════════════
   CANVAS
═══════════════════════════════════════════ */
#canvas-wrap {
  position: fixed; inset: 0;
  background: var(--canvas);
  transition: background 0.35s ease;
}
canvas { position: absolute; top: 0; left: 0; touch-action: none; }
#grid-canvas    { pointer-events: none; }
#stroke-canvas  { cursor: crosshair; }
#overlay-canvas { pointer-events: none; }

#stroke-canvas.tool-pan       { cursor: grab; }
#stroke-canvas.tool-pan.panning { cursor: grabbing; }
#stroke-canvas.tool-eraser    { cursor: none; }
#stroke-canvas.tool-select    { cursor: default; }
#stroke-canvas.tool-text      { cursor: text; }
#stroke-canvas.tool-laser     { cursor: none; }

/* ═══════════════════════════════════════════
   TOP BAR
═══════════════════════════════════════════ */
#top-bar {
  position: fixed; top: 0; left: 0; right: 0;
  height: var(--topbar-h);
  z-index: 200;
  background: var(--surface);
  backdrop-filter: blur(var(--blur)) saturate(1.4);
  -webkit-backdrop-filter: blur(var(--blur)) saturate(1.4);
  border-bottom: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  display: flex; align-items: center;
  padding: 0 10px; gap: 2px;
  padding-top: env(safe-area-inset-top, 0);
  overflow-x: auto; overflow-y: hidden;
  scrollbar-width: none;
}
#top-bar::-webkit-scrollbar { display: none; }

.logo-wrap {
  display: flex; align-items: center; gap: 8px;
  padding: 0 12px 0 6px;
  border-right: 1px solid var(--border);
  margin-right: 6px; flex-shrink: 0;
  height: 100%;
}
.logo-icon {
  width: 28px; height: 28px; border-radius: var(--radius);
  background: var(--gradient);
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(var(--accent-rgb), 0.3);
}
.logo-icon svg { width: 14px; height: 14px; stroke: white; stroke-width: 2.2; fill: none; }
.logo-text {
  font-size: 14px; font-weight: 700; color: var(--text);
  letter-spacing: -0.4px; white-space: nowrap;
}

.tb-spacer { flex: 1; min-width: 4px; }
.vdiv { width: 1px; height: 20px; background: var(--border-strong); margin: 0 4px; flex-shrink: 0; opacity: 0.6; }

/* ── Top Bar Buttons ── */
.tbtn {
  width: 34px; height: 34px;
  border: none; background: transparent;
  color: var(--text-dim); border-radius: var(--radius);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  position: relative; flex-shrink: 0;
  transition: background 0.15s, color 0.15s, transform 0.15s var(--spring);
}
.tbtn svg { width: 16px; height: 16px; stroke-width: 1.7; pointer-events: none; fill: none; stroke: currentColor; }
.tbtn:hover  { background: var(--surface-hover); color: var(--text); transform: scale(1.06); }
.tbtn:active { background: var(--surface-active); transform: scale(0.92); }
.tbtn.active { background: var(--accent-light); color: var(--accent); }

#page-indicator, #zoom-indicator {
  font-family: var(--mono);
  font-size: 10.5px; color: var(--text-dim);
  padding: 4px 8px;
  background: var(--surface-hover);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  flex-shrink: 0; white-space: nowrap;
}

/* ── Tooltip ── */
.tip {
  position: absolute;
  background: var(--surface-solid); color: var(--text);
  font-size: 11px; font-weight: 500; padding: 5px 10px;
  border-radius: var(--radius-sm); white-space: nowrap;
  border: 1px solid var(--border);
  opacity: 0; pointer-events: none;
  transition: opacity 0.12s, transform 0.12s var(--ease);
  box-shadow: var(--shadow);
  z-index: 9999;
  bottom: calc(100% + 8px); left: 50%;
  transform: translateX(-50%) translateY(3px);
}
.tbtn:hover .tip, .ibtn:hover .tip { opacity: 1; }
.tbtn:hover .tip { transform: translateX(-50%) translateY(0); }
.tip-r {
  bottom: auto; left: calc(100% + 10px); top: 50%;
  transform: translateY(-50%) translateX(-3px);
}
.ibtn:hover .tip-r { transform: translateY(-50%) translateX(0); opacity: 1; }

/* ═══════════════════════════════════════════
   LEFT TOOLBAR
═══════════════════════════════════════════ */
#left-toolbar {
  position: fixed;
  left: 0; top: var(--topbar-h); bottom: 0;
  width: var(--toolbar-w);
  z-index: 200;
  background: var(--surface);
  backdrop-filter: blur(var(--blur)) saturate(1.4);
  -webkit-backdrop-filter: blur(var(--blur)) saturate(1.4);
  border-right: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  display: flex; flex-direction: column; align-items: center;
  padding: 10px 0; gap: 2px;
  padding-left: env(safe-area-inset-left, 0);
  overflow-y: auto; overflow-x: visible;
  scrollbar-width: none;
}
#left-toolbar::-webkit-scrollbar { display: none; }

.tb-section {
  display: flex; flex-direction: column; align-items: center; gap: 2px;
  width: 100%; padding: 0 6px; flex-shrink: 0;
}
.tb-sep { width: 26px; height: 1px; background: var(--border-strong); margin: 5px 0; flex-shrink: 0; opacity: 0.6; }

/* ── Toolbar Icon Button ── */
.ibtn {
  width: 40px; height: 40px;
  border: none; background: transparent;
  color: var(--text-dim); border-radius: var(--radius);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  position: relative; flex-shrink: 0;
  transition: background 0.15s, color 0.15s, transform 0.15s var(--spring);
  font-family: var(--font);
}
.ibtn svg { width: 18px; height: 18px; stroke-width: 1.7; pointer-events: none; fill: none; stroke: currentColor; }
.ibtn:hover  { background: var(--surface-hover); color: var(--text); transform: scale(1.08); }
.ibtn:active { background: var(--surface-active); transform: scale(0.92); }
.ibtn.active {
  background: var(--accent-light); color: var(--accent);
}
.ibtn.active::before {
  content: '';
  position: absolute; left: -6px; top: 50%; transform: translateY(-50%);
  width: 3px; height: 18px; background: var(--accent); border-radius: 0 3px 3px 0;
}

/* ── Color Ring ── */
#color-ring {
  width: 22px; height: 22px; border-radius: 50%;
  background: #e8e6e3;
  border: 2.5px solid var(--border-strong);
  box-shadow: 0 0 0 1px rgba(var(--accent-rgb),0.12);
  pointer-events: none;
  transition: box-shadow 0.15s;
}
#color-btn:hover #color-ring { box-shadow: 0 0 0 2px rgba(var(--accent-rgb),0.2); }

/* ── Tool Group + Flyout ── */
.tool-group { position: relative; width: 100%; display: flex; justify-content: center; }

.sub-tools {
  position: absolute;
  left: calc(100% + 10px); top: 0;
  min-width: 185px;
  background: var(--surface);
  backdrop-filter: blur(var(--blur)) saturate(1.4);
  -webkit-backdrop-filter: blur(var(--blur)) saturate(1.4);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  padding: 5px;
  display: flex; flex-direction: column; gap: 1px;
  opacity: 0; pointer-events: none;
  transform: translateX(-6px) scale(0.96);
  transform-origin: left top;
  transition: opacity 0.12s var(--ease), transform 0.15s var(--spring);
  z-index: 500;
}
.sub-tools.open {
  opacity: 1; pointer-events: all;
  transform: translateX(0) scale(1);
}

.sub-item {
  display: flex; align-items: center; gap: 10px;
  padding: 8px 12px; border-radius: var(--radius);
  cursor: pointer; font-size: 13px; font-weight: 450; color: var(--text);
  transition: background 0.1s, color 0.1s;
}
.sub-item:hover  { background: var(--surface-hover); }
.sub-item.active { background: var(--accent-light); color: var(--accent); font-weight: 550; }
.sub-item svg { width: 16px; height: 16px; flex-shrink: 0; fill: none; stroke: currentColor; stroke-width: 1.7; }
.sub-key {
  margin-left: auto; font-family: var(--mono); font-size: 10px; color: var(--text-faint);
  background: var(--surface-hover); border-radius: var(--radius-xs); padding: 2px 6px;
  border: 1px solid var(--border);
}

/* ═══════════════════════════════════════════
   CUSTOM RANGE INPUT
═══════════════════════════════════════════ */
input[type=range] {
  -webkit-appearance: none; appearance: none;
  background: transparent; cursor: pointer;
  height: 20px;
}
input[type=range]::-webkit-slider-runnable-track {
  height: 4px; border-radius: 2px;
  background: var(--border-strong);
}
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none; appearance: none;
  width: 14px; height: 14px; border-radius: 50%;
  background: var(--accent);
  border: 2px solid var(--surface-solid);
  box-shadow: var(--shadow-xs);
  margin-top: -5px;
  transition: transform 0.12s var(--spring), box-shadow 0.12s;
}
input[type=range]::-webkit-slider-thumb:hover {
  transform: scale(1.2);
  box-shadow: 0 0 0 4px var(--accent-glow);
}
input[type=range]::-moz-range-track {
  height: 4px; border-radius: 2px;
  background: var(--border-strong); border: none;
}
input[type=range]::-moz-range-thumb {
  width: 14px; height: 14px; border-radius: 50%;
  background: var(--accent);
  border: 2px solid var(--surface-solid);
  box-shadow: var(--shadow-xs);
}
input[type=range]:focus { outline: none; }

/* ═══════════════════════════════════════════
   TEXT OPTIONS TOOLBAR
═══════════════════════════════════════════ */
#text-toolbar {
  position: fixed;
  top: calc(var(--topbar-h) + 10px);
  left: 50%; transform: translateX(-50%);
  z-index: 400;
  background: var(--surface);
  backdrop-filter: blur(var(--blur)) saturate(1.4);
  -webkit-backdrop-filter: blur(var(--blur)) saturate(1.4);
  border: 1px solid var(--border);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-lg);
  padding: 6px 12px;
  display: none; align-items: center; gap: 6px;
  animation: slideDown 0.2s var(--ease);
  max-width: calc(100vw - 20px);
  flex-wrap: wrap; justify-content: center;
}
#text-toolbar.open { display: flex; }

#text-toolbar select {
  background: var(--surface-solid);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text);
  font-family: var(--font);
  font-size: 12px; padding: 5px 8px;
  cursor: pointer; outline: none;
  transition: border-color 0.12s;
}
#text-toolbar select option {
  background: var(--surface-solid);
  color: var(--text);
}
#text-toolbar select:focus { border-color: var(--accent); }

#text-toolbar input[type=number] {
  width: 52px;
  background: var(--surface-hover);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text); font-family: var(--mono);
  font-size: 12px; padding: 5px 6px;
  text-align: center; outline: none;
  transition: border-color 0.12s;
}
#text-toolbar input[type=number]:focus { border-color: var(--accent); }

.tt-btn {
  width: 30px; height: 30px;
  border: 1px solid var(--border);
  background: var(--surface-hover);
  color: var(--text-dim);
  border-radius: var(--radius-sm);
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  font-size: 13px;
  transition: all 0.12s;
}
.tt-btn:hover { background: var(--surface-active); color: var(--text); }
.tt-btn.active { background: var(--accent-light); color: var(--accent); border-color: rgba(var(--accent-rgb),0.25); }

.tt-div { width: 1px; height: 20px; background: var(--border); flex-shrink: 0; }

/* ═══════════════════════════════════════════
   ELEMENT SELECTION OVERLAY
═══════════════════════════════════════════ */
#element-overlay {
  position: fixed; z-index: 350;
  border: 2px solid var(--accent);
  border-radius: var(--radius-xs);
  pointer-events: none;
  background: rgba(var(--accent-rgb), 0.03);
}

#overlay-drag-handle {
  position: absolute;
  top: -30px; left: 50%; transform: translateX(-50%);
  width: 34px; height: 22px;
  background: var(--accent);
  color: #fff;
  border-radius: var(--radius-sm) var(--radius-sm) 0 0;
  font-size: 11px; line-height: 22px; text-align: center;
  cursor: grab; pointer-events: all;
  transition: background 0.12s;
}
#overlay-drag-handle:hover { filter: brightness(1.15); }
#overlay-drag-handle:active { cursor: grabbing; }

#overlay-edit-btn, #overlay-delete-btn {
  position: absolute; top: -30px;
  width: 24px; height: 22px;
  background: var(--surface-solid);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text-dim);
  font-size: 12px; line-height: 22px; text-align: center;
  cursor: pointer; pointer-events: all;
  transition: all 0.12s;
  display: flex; align-items: center; justify-content: center;
}
#overlay-edit-btn { right: 28px; }
#overlay-delete-btn { right: 0; }
#overlay-edit-btn:hover { background: var(--accent-light); color: var(--accent); }
#overlay-delete-btn:hover { background: var(--danger-bg); color: var(--danger); }

#overlay-resize-handles {
  position: absolute; inset: -6px;
  pointer-events: none; display: none;
}
#overlay-resize-handles.visible { display: block; pointer-events: all; }
.resize-dot {
  position: absolute; width: 10px; height: 10px;
  background: var(--accent); border: 2px solid #fff;
  border-radius: 50%; pointer-events: all;
  transition: transform 0.1s var(--spring);
}
.resize-dot:hover { transform: scale(1.35); }
.resize-dot.nw { top: 0; left: 0; cursor: nwse-resize; transform: translate(-2px,-2px); }
.resize-dot.n  { top: 0; left: 50%; margin-left: -5px; cursor: ns-resize; }
.resize-dot.ne { top: 0; right: 0; cursor: nesw-resize; transform: translate(2px,-2px); }
.resize-dot.e  { top: 50%; right: 0; margin-top: -5px; cursor: ew-resize; transform: translateX(2px); }
.resize-dot.se { bottom: 0; right: 0; cursor: nwse-resize; transform: translate(2px,2px); }
.resize-dot.s  { bottom: 0; left: 50%; margin-left: -5px; cursor: ns-resize; }
.resize-dot.sw { bottom: 0; left: 0; cursor: nesw-resize; transform: translate(-2px,2px); }
.resize-dot.w  { top: 50%; left: 0; margin-top: -5px; cursor: ew-resize; transform: translateX(-2px); }
.resize-dot.nw:hover { transform: translate(-2px,-2px) scale(1.35); }
.resize-dot.ne:hover { transform: translate(2px,-2px) scale(1.35); }
.resize-dot.se:hover { transform: translate(2px,2px) scale(1.35); }
.resize-dot.sw:hover { transform: translate(-2px,2px) scale(1.35); }
.resize-dot.e:hover  { transform: translateX(2px) scale(1.35); }
.resize-dot.w:hover  { transform: translateX(-2px) scale(1.35); }

/* ═══════════════════════════════════════════
   PAGES PANEL
═══════════════════════════════════════════ */
#pages-panel {
  position: fixed; bottom: 14px; left: 50%; transform: translateX(-50%);
  z-index: 200;
  background: var(--surface);
  backdrop-filter: blur(var(--blur)) saturate(1.4);
  -webkit-backdrop-filter: blur(var(--blur)) saturate(1.4);
  border: 1px solid var(--border);
  border-radius: var(--radius-xl); box-shadow: var(--shadow);
  padding: 5px; display: flex; align-items: center; gap: 5px;
  max-width: calc(100vw - var(--toolbar-w) - 40px);
  overflow-x: auto;
  padding-bottom: calc(5px + env(safe-area-inset-bottom, 0));
}
.page-thumb {
  width: 58px; height: 38px; border-radius: var(--radius-sm);
  background: var(--thumb-bg); border: 2px solid var(--thumb-border);
  cursor: pointer; overflow: hidden; position: relative; flex-shrink: 0;
  transition: border-color 0.15s, transform 0.15s var(--spring), box-shadow 0.15s;
}
.page-thumb:hover  { border-color: var(--accent); transform: scale(1.06); }
.page-thumb.active { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent-glow); }
.page-thumb canvas { width: 100%; height: 100%; display: block; }
.page-num {
  position: absolute; bottom: 1px; right: 2px;
  font-size: 8px; font-family: var(--mono); color: var(--text-faint);
}
.page-add-btn {
  width: 34px; height: 38px; border: 2px dashed var(--border-strong);
  border-radius: var(--radius-sm); background: none; color: var(--text-faint);
  cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center;
  flex-shrink: 0; transition: all 0.15s;
}
.page-add-btn:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-light); }

/* ═══════════════════════════════════════════
   ZOOM CONTROLS
═══════════════════════════════════════════ */
#zoom-bar {
  position: fixed; left: calc(var(--toolbar-w) + 12px); bottom: 14px;
  z-index: 200;
  background: var(--surface);
  backdrop-filter: blur(var(--blur)) saturate(1.4);
  -webkit-backdrop-filter: blur(var(--blur)) saturate(1.4);
  border: 1px solid var(--border);
  border-radius: var(--radius-xl); box-shadow: var(--shadow);
  display: flex; align-items: center; gap: 0; padding: 3px;
  padding-bottom: calc(3px + env(safe-area-inset-bottom, 0));
}
.zbtn {
  width: 30px; height: 30px; border: none; background: transparent;
  color: var(--text-dim); border-radius: var(--radius);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  transition: background 0.1s, color 0.1s;
}
.zbtn:hover { background: var(--surface-hover); color: var(--text); }
.zbtn svg { width: 14px; height: 14px; stroke-width: 2; fill: none; stroke: currentColor; }
#zoom-label {
  font-family: var(--mono); font-size: 10.5px; color: var(--text-dim);
  min-width: 40px; text-align: center; padding: 0 2px;
}

/* ═══════════════════════════════════════════
   MINIMAP
═══════════════════════════════════════════ */
#minimap-wrap {
  position: fixed; bottom: 72px; right: 14px;
  z-index: 200;
  background: var(--surface-solid); border: 1px solid var(--border);
  border-radius: var(--radius-lg); box-shadow: var(--shadow);
  overflow: hidden; width: 160px; height: 110px;
  opacity: 0; pointer-events: none;
  transform: scale(0.92) translateY(8px);
  transition: opacity 0.2s var(--ease), transform 0.2s var(--spring);
}
#minimap-wrap.open { opacity: 1; pointer-events: all; transform: scale(1) translateY(0); }
#minimap-canvas { width: 100%; height: 100%; cursor: crosshair; display: block; }
#minimap-viewport {
  position: absolute; border: 2px solid var(--accent);
  background: rgba(var(--accent-rgb), 0.06); pointer-events: none;
}

/* ═══════════════════════════════════════════
   STROKE OPTIONS FLYOUT
═══════════════════════════════════════════ */
#stroke-options {
  position: fixed;
  left: calc(var(--toolbar-w) + 10px);
  background: var(--surface);
  backdrop-filter: blur(var(--blur)) saturate(1.4);
  -webkit-backdrop-filter: blur(var(--blur)) saturate(1.4);
  border: 1px solid var(--border);
  border-radius: var(--radius-xl); box-shadow: var(--shadow-lg);
  padding: 16px; width: 224px;
  display: none; flex-direction: column; gap: 14px;
  z-index: 500;
  animation: slideDown 0.15s var(--ease);
  max-height: calc(100vh - var(--topbar-h) - 24px);
  overflow-y: auto;
}
#stroke-options.open { display: flex; }

.so-label { font-size: 10px; font-weight: 600; color: var(--text-faint); text-transform: uppercase; letter-spacing: 0.8px; }

.so-size-row { display: flex; align-items: center; gap: 10px; }
.so-size-row input[type=range] { flex: 1; }
.so-size-val { font-family: var(--mono); font-size: 11px; color: var(--text-dim); min-width: 24px; text-align: right; }

.so-smooth { display: flex; gap: 3px; }
.smooth-btn {
  flex: 1; padding: 6px 4px; border-radius: var(--radius-sm);
  border: 1px solid var(--border); background: var(--surface-hover);
  color: var(--text-dim); font-size: 10px; font-weight: 600; cursor: pointer;
  transition: all 0.12s; font-family: var(--mono); text-align: center;
}
.smooth-btn:hover { background: var(--surface-active); color: var(--text); }
.smooth-btn.active { background: var(--accent-light); color: var(--accent); border-color: rgba(var(--accent-rgb),0.25); }

/* ═══════════════════════════════════════════
   COLOR PICKER PANEL
═══════════════════════════════════════════ */
#color-picker-panel {
  position: fixed; z-index: 600;
  background: var(--surface);
  backdrop-filter: blur(var(--blur)) saturate(1.4);
  -webkit-backdrop-filter: blur(var(--blur)) saturate(1.4);
  border: 1px solid var(--border);
  border-radius: var(--radius-xl); box-shadow: var(--shadow-lg);
  padding: 16px; width: 228px;
  display: none; flex-direction: column; gap: 14px;
  animation: slideDown 0.15s var(--ease);
}
#color-picker-panel.open { display: flex; }
.cp-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; color: var(--text-faint); }
.cp-presets { display: flex; flex-wrap: wrap; gap: 6px; }
.cp-swatch {
  width: 26px; height: 26px; border-radius: 50%; cursor: pointer;
  border: 2.5px solid transparent;
  transition: transform 0.12s var(--spring), border-color 0.12s, box-shadow 0.12s;
}
.cp-swatch:hover { transform: scale(1.18); }
.cp-swatch.active { border-color: var(--accent); box-shadow: 0 0 0 2px var(--surface-solid), 0 0 0 4px rgba(var(--accent-rgb),0.2); }
.cp-row { display: flex; gap: 8px; align-items: center; }
.cp-row input[type=color] {
  width: 36px; height: 36px; border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 2px; background: var(--surface-hover); cursor: pointer;
}
.cp-row input[type=text] {
  flex: 1; background: var(--surface-hover); border: 1px solid var(--border);
  border-radius: var(--radius-sm); color: var(--text); font-family: var(--mono);
  font-size: 12px; padding: 7px 10px; outline: none;
  transition: border-color 0.12s;
}
.cp-row input[type=text]:focus { border-color: var(--accent); }

/* ═══════════════════════════════════════════
   INSPECTOR
═══════════════════════════════════════════ */
#inspector {
  position: fixed; right: 14px; top: calc(var(--topbar-h) + 14px);
  z-index: 300;
  background: var(--surface);
  backdrop-filter: blur(var(--blur)) saturate(1.4);
  -webkit-backdrop-filter: blur(var(--blur)) saturate(1.4);
  border: 1px solid var(--border);
  border-radius: var(--radius-xl); box-shadow: var(--shadow-lg);
  padding: 14px; width: 185px;
  opacity: 0; pointer-events: none;
  transform: translateX(8px);
  transition: opacity 0.15s, transform 0.2s var(--spring);
  display: flex; flex-direction: column; gap: 12px;
}
#inspector.open { opacity: 1; pointer-events: all; transform: translateX(0); }
#inspector h4 { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; color: var(--text-faint); }
#insp-color { width:100%; height:28px; border-radius:var(--radius-sm); cursor:pointer; border:1px solid var(--border); }
.insp-row { display: flex; flex-direction: column; gap: 5px; }
.insp-label { font-size: 11px; color: var(--text-dim); }
.insp-actions { display: flex; flex-wrap: wrap; gap: 4px; }
.insp-btn {
  flex: 1; padding: 6px 4px; border-radius: var(--radius-sm);
  border: 1px solid var(--border); background: var(--surface-hover);
  color: var(--text-dim); font-size: 11px; font-weight: 500; cursor: pointer;
  transition: all 0.12s; text-align: center; min-width: 52px; font-family: var(--font);
}
.insp-btn:hover { background: var(--surface-active); color: var(--text); }
.insp-btn.danger:hover { background: var(--danger-bg); color: var(--danger); border-color: rgba(239,68,68,0.25); }
.range-row { display: flex; align-items: center; gap: 8px; }

/* ═══════════════════════════════════════════
   HISTORY SCRUBBER
═══════════════════════════════════════════ */
#history-bar {
  position: fixed; bottom: 72px; left: 50%;
  transform: translateX(-50%) translateY(8px);
  z-index: 150;
  background: var(--surface);
  backdrop-filter: blur(var(--blur)) saturate(1.4);
  -webkit-backdrop-filter: blur(var(--blur)) saturate(1.4);
  border: 1px solid var(--border);
  border-radius: var(--radius-xl); box-shadow: var(--shadow);
  padding: 8px 16px; display: flex; align-items: center; gap: 10px;
  width: 360px; max-width: calc(100vw - 40px);
  opacity: 0; pointer-events: none;
  transition: opacity 0.2s, transform 0.22s var(--spring);
}
#history-bar.open {
  opacity: 1; pointer-events: all;
  transform: translateX(-50%) translateY(0);
}
#history-bar label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-dim); white-space: nowrap; }
#history-count { font-family: var(--mono); font-size: 10px; color: var(--text-faint); min-width: 40px; text-align: right; }

/* ═══════════════════════════════════════════
   RADIAL MENU
═══════════════════════════════════════════ */
#radial-menu { position: fixed; z-index: 800; display: none; pointer-events: none; }
#radial-menu.open { display: block; pointer-events: all; }
.radial-bg {
  position: absolute; border-radius: 50%;
  background: var(--surface-solid); border: 1px solid var(--border);
  box-shadow: var(--shadow-lg); transform: translate(-50%,-50%);
}
.radial-item {
  position: absolute; width: 40px; height: 40px; border-radius: 50%;
  background: var(--surface-solid); border: 1px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; color: var(--text-dim);
  transition: all 0.15s var(--spring); transform: translate(-50%,-50%);
  box-shadow: var(--shadow-sm);
}
.radial-item svg { width: 16px; height: 16px; stroke-width: 1.7; fill: none; stroke: currentColor; }
.radial-item:hover {
  background: var(--accent); color: #fff;
  transform: translate(-50%,-50%) scale(1.2);
  box-shadow: 0 4px 16px rgba(var(--accent-rgb),0.4);
}

/* ═══════════════════════════════════════════
   TEXT OVERLAY
═══════════════════════════════════════════ */
.text-overlay {
  position: fixed; z-index: 300;
  background: rgba(var(--accent-rgb), 0.03);
  border: 2px dashed var(--accent); border-radius: var(--radius-xs);
  outline: none; resize: none;
  color: var(--text);
  padding: 6px 8px; min-width: 120px; min-height: 40px;
  line-height: 1.4; caret-color: var(--accent);
}

/* ═══════════════════════════════════════════
   CURSORS
═══════════════════════════════════════════ */
#eraser-cursor {
  position: fixed; border-radius: 50%; pointer-events: none; z-index: 999;
  border: 2px solid rgba(0,0,0,0.35); background: rgba(255,255,255,0.18);
  transform: translate(-50%,-50%); display: none;
  transition: width 0.08s, height 0.08s;
}
body.dark #eraser-cursor { border-color: rgba(255,255,255,0.45); background: rgba(0,0,0,0.25); }

#laser-cursor {
  position: fixed; border-radius: 50%; pointer-events: none; z-index: 999;
  background: #ff3c3c; transform: translate(-50%,-50%); display: none;
  width: 10px; height: 10px;
  box-shadow: 0 0 10px rgba(255,60,60,0.8), 0 0 22px rgba(255,60,60,0.35);
}

/* ═══════════════════════════════════════════
   SELECTION SVG
═══════════════════════════════════════════ */
#selection-svg { position: fixed; inset: 0; pointer-events: none; z-index: 50; width: 100%; height: 100%; }

/* ═══════════════════════════════════════════
   NOTIFICATION TOAST
═══════════════════════════════════════════ */
#notif {
  position: fixed; top: calc(var(--topbar-h) + 12px); left: 50%;
  transform: translateX(-50%) translateY(-8px);
  z-index: 1000;
  background: var(--surface-solid); color: var(--text);
  border: 1px solid var(--border);
  border-radius: var(--radius); padding: 8px 18px;
  font-size: 12px; font-weight: 500;
  box-shadow: var(--shadow-lg);
  opacity: 0; pointer-events: none;
  transition: opacity 0.2s, transform 0.2s var(--spring);
  max-width: calc(100vw - 40px);
  white-space: nowrap;
}
#notif.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* ═══════════════════════════════════════════
   DRAG & DROP OVERLAY
═══════════════════════════════════════════ */
body.dragover::after {
  content: 'Drop image here';
  position: fixed; inset: 0; z-index: 9999;
  display: flex; align-items: center; justify-content: center;
  background: rgba(var(--accent-rgb), 0.1);
  border: 3px dashed var(--accent);
  color: var(--accent);
  font-size: 22px; font-weight: 600; font-family: var(--font);
  pointer-events: none;
}

/* ═══════════════════════════════════════════
   SHAPE PICKER BAR
═══════════════════════════════════════════ */
#shape-bar {
  position: fixed;
  top: calc(var(--topbar-h) + 10px);
  left: 50%; transform: translateX(-50%);
  z-index: 400;
  background: var(--surface);
  backdrop-filter: blur(var(--blur)) saturate(1.4);
  -webkit-backdrop-filter: blur(var(--blur)) saturate(1.4);
  border: 1px solid var(--border);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-lg);
  padding: 4px 5px;
  display: none; align-items: center; gap: 2px;
  animation: slideDown 0.2s var(--ease);
  max-width: calc(100vw - 16px);
  overflow-x: auto;
  scrollbar-width: none;
}
#shape-bar::-webkit-scrollbar { display: none; }
#shape-bar.open { display: flex; }

.shape-pick {
  display: flex; flex-direction: column; align-items: center; gap: 2px;
  padding: 6px 10px; border: none;
  background: transparent; color: var(--text-dim);
  border-radius: var(--radius);
  cursor: pointer; font-family: var(--font);
  font-size: 9px; font-weight: 550; letter-spacing: 0.2px;
  transition: background 0.12s, color 0.12s, transform 0.15s var(--spring);
  min-width: 48px; flex-shrink: 0;
  white-space: nowrap;
}
.shape-pick svg {
  width: 22px; height: 22px;
  fill: none; stroke: currentColor; stroke-width: 1.6;
  stroke-linejoin: round; stroke-linecap: round;
}
.shape-pick:hover {
  background: var(--surface-hover); color: var(--text);
  transform: scale(1.06);
}
.shape-pick.active {
  background: var(--accent-light); color: var(--accent);
}
.shape-pick.active svg { stroke-width: 1.9; }

/* ═══════════════════════════════════════════
   ABOUT MODAL
═══════════════════════════════════════════ */
#about-overlay {
  position: fixed; inset: 0; z-index: 9000;
  background: rgba(0,0,0,0.45);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  display: none; align-items: center; justify-content: center;
  padding: 16px;
}
#about-overlay.open { display: flex; }

#about-modal {
  background: var(--surface-solid);
  border: 1px solid var(--border);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-lg);
  padding: 32px 36px;
  width: 360px; max-width: 100%;
  text-align: center;
  position: relative;
  animation: slideDown 0.25s var(--ease);
}

#about-close {
  position: absolute; top: 12px; right: 14px;
  border: none; background: transparent;
  color: var(--text-faint); font-size: 22px;
  cursor: pointer; width: 32px; height: 32px;
  border-radius: var(--radius);
  display: flex; align-items: center; justify-content: center;
  transition: background 0.12s, color 0.12s;
}
#about-close:hover { background: var(--surface-hover); color: var(--text); }

.about-logo {
  display: flex; flex-direction: column; align-items: center; gap: 12px;
  margin-bottom: 16px;
}
.about-logo-icon {
  width: 52px; height: 52px; border-radius: 16px;
  background: var(--gradient);
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 16px rgba(var(--accent-rgb), 0.3);
}
.about-logo-icon svg {
  width: 26px; height: 26px;
  stroke: white; stroke-width: 2; fill: none;
}
.about-title {
  font-size: 22px; font-weight: 700; color: var(--text);
  letter-spacing: -0.4px;
}
.about-desc {
  font-size: 13px; color: var(--text-dim); line-height: 1.6;
  margin-bottom: 18px;
}
.about-divider {
  height: 1px; background: var(--border-strong); margin: 0 auto 18px;
  width: 50px;
}
.about-credit {
  display: flex; flex-direction: column; gap: 5px;
  margin-bottom: 14px;
}
.about-label {
  font-size: 10px; font-weight: 600; text-transform: uppercase;
  letter-spacing: 0.8px; color: var(--text-faint);
}
.about-author {
  font-size: 15px; font-weight: 600; color: var(--accent);
  text-decoration: none; transition: opacity 0.12s;
}
.about-author:hover { opacity: 0.8; text-decoration: underline; }
.about-copy {
  font-size: 11px; color: var(--text-faint); margin-top: 4px;
  font-family: var(--mono);
}

/* ═══════════════════════════════════════════
   MOBILE SIDEBAR (only on <=600px)
═══════════════════════════════════════════ */
#mobile-menu-btn { display: none; }

#mobile-sidebar-overlay {
  position: fixed; inset: 0; z-index: 8000;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
  opacity: 0; pointer-events: none;
  transition: opacity 0.25s ease;
}
#mobile-sidebar-overlay.open { opacity: 1; pointer-events: all; }

#mobile-sidebar {
  position: fixed; top: 0; left: 0; bottom: 0;
  width: 270px; max-width: 80vw;
  z-index: 8500;
  background: var(--surface-solid);
  border-right: 1px solid var(--border);
  box-shadow: var(--shadow-lg);
  transform: translateX(-100%);
  transition: transform 0.28s var(--ease);
  display: none;
  flex-direction: column;
  overflow: hidden;
}
#mobile-sidebar.open { transform: translateX(0); }

.ms-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 14px 16px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}
.ms-logo {
  display: flex; align-items: center; gap: 10px;
}
.ms-logo .logo-icon {
  width: 30px; height: 30px; border-radius: var(--radius);
  background: var(--gradient);
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 2px 8px rgba(var(--accent-rgb), 0.3);
}
.ms-logo .logo-icon svg { width: 15px; height: 15px; stroke: white; stroke-width: 2.2; fill: none; }
.ms-logo span { font-size: 15px; font-weight: 700; color: var(--text); letter-spacing: -0.3px; }
#mobile-sidebar-close {
  width: 32px; height: 32px; border: none; background: var(--surface-hover);
  color: var(--text-dim); font-size: 20px; border-radius: var(--radius);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  transition: background 0.12s, color 0.12s;
}
#mobile-sidebar-close:hover { background: var(--surface-active); color: var(--text); }

.ms-body {
  flex: 1; overflow-y: auto; overflow-x: hidden;
  padding: 8px 0 20px;
  scrollbar-width: none;
}
.ms-body::-webkit-scrollbar { display: none; }

.ms-section { padding: 0 12px; }
.ms-label {
  font-size: 10px; font-weight: 650; text-transform: uppercase;
  letter-spacing: 0.9px; color: var(--text-faint);
  padding: 8px 8px 4px; margin-bottom: 2px;
}
.ms-divider {
  height: 1px; background: var(--border);
  margin: 6px 16px;
}

.ms-btn {
  display: flex; align-items: center; gap: 12px;
  width: 100%; padding: 10px 12px;
  border: none; background: transparent;
  color: var(--text); font-family: var(--font);
  font-size: 13.5px; font-weight: 450;
  border-radius: var(--radius);
  cursor: pointer;
  transition: background 0.12s, color 0.12s;
  text-align: left;
}
.ms-btn svg {
  width: 18px; height: 18px; flex-shrink: 0;
  fill: none; stroke: currentColor; stroke-width: 1.7;
}
.ms-btn:hover { background: var(--surface-hover); }
.ms-btn:active { background: var(--surface-active); }
.ms-btn.active {
  background: var(--accent-light); color: var(--accent); font-weight: 550;
}
.ms-btn.active svg { stroke-width: 1.9; }

.ms-badge {
  margin-left: auto; font-family: var(--mono);
  font-size: 9px; font-weight: 600;
  padding: 2px 7px; border-radius: var(--radius-xs);
  background: var(--surface-hover); color: var(--text-faint);
  border: 1px solid var(--border);
}
.ms-badge.on { background: var(--accent-light); color: var(--accent); border-color: rgba(var(--accent-rgb),0.2); }

.ms-color-dot {
  width: 20px; height: 20px; border-radius: 50%;
  background: #e8e6e3; flex-shrink: 0;
  border: 2px solid var(--border-strong);
}

.ms-shapes-grid {
  display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px;
  padding: 0 4px; margin-bottom: 4px;
}
.ms-shape-btn {
  display: flex; flex-direction: column; align-items: center; gap: 3px;
  padding: 8px 4px; border: none;
  background: var(--surface-hover); color: var(--text-dim);
  border-radius: var(--radius);
  cursor: pointer; font-family: var(--font);
  font-size: 9px; font-weight: 550;
  transition: background 0.12s, color 0.12s;
}
.ms-shape-btn svg {
  width: 22px; height: 22px;
  fill: none; stroke: currentColor; stroke-width: 1.6;
  stroke-linejoin: round; stroke-linecap: round;
}
.ms-shape-btn:hover { background: var(--surface-active); color: var(--text); }
.ms-shape-btn.active {
  background: var(--accent-light); color: var(--accent);
}

/* ═══════════════════════════════════════════
   SCROLLBAR
═══════════════════════════════════════════ */
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border-strong); border-radius: 2px; }

/* ═══════════════════════════════════════════
   ANIMATIONS
═══════════════════════════════════════════ */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(4px) scale(0.98); }
  to   { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes slideDown {
  from { opacity: 0; transform: translateX(-50%) translateY(-6px) scale(0.97); }
  to   { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
}

/* ═══════════════════════════════════════════
   RESPONSIVE — COMPACT DESKTOP (<=1100px)
═══════════════════════════════════════════ */
@media (max-width: 1100px) {
  .logo-text { display: none; }
  .logo-wrap { padding: 0 6px; margin-right: 2px; }
  #page-indicator { font-size: 10px; padding: 3px 6px; }
  #zoom-indicator { font-size: 10px; padding: 3px 6px; }
  .vdiv { margin: 0 2px; }
}

/* ═══════════════════════════════════════════
   RESPONSIVE — TABLET (<=900px)
═══════════════════════════════════════════ */
@media (max-width: 900px) {
  :root { --toolbar-w: 48px; --topbar-h: 44px; }

  .ibtn { width: 36px; height: 36px; }
  .ibtn svg { width: 17px; height: 17px; }
  .ibtn.active::before { width: 2.5px; height: 16px; left: -5px; }

  .tbtn { width: 30px; height: 30px; }
  .tbtn svg { width: 14px; height: 14px; }

  #page-indicator { display: none; }

  #left-toolbar { padding: 6px 0; gap: 1px; }
  .tb-section { padding: 0 5px; gap: 1px; }
  .tb-sep { width: 22px; margin: 4px 0; }

  #pages-panel { max-width: calc(100vw - var(--toolbar-w) - 20px); padding: 4px; }
  .page-thumb { width: 48px; height: 32px; }
  .page-add-btn { width: 30px; height: 32px; }

  #zoom-bar { left: calc(var(--toolbar-w) + 8px); bottom: 10px; }
  #stroke-options { left: calc(var(--toolbar-w) + 6px); width: 210px; padding: 12px; }
  #inspector { width: 170px; padding: 12px; right: 10px; }
  #history-bar { width: 300px; }

  .sub-tools { left: calc(100% + 6px); min-width: 165px; }
  .sub-item { padding: 6px 10px; font-size: 12px; gap: 8px; }

  #minimap-wrap { bottom: 60px; right: 10px; width: 130px; height: 90px; }

  .shape-pick { padding: 5px 8px; min-width: 44px; }

  .tip { display: none; }
}

/* ═══════════════════════════════════════════
   RESPONSIVE — MOBILE (<=600px)
═══════════════════════════════════════════ */
@media (max-width: 600px) {
  :root { --toolbar-w: 0px; --topbar-h: 44px; }

  /* Show hamburger, hide desktop-only top-bar items */
  #mobile-menu-btn { display: flex; }
  #mobile-sidebar { display: flex; }

  #history-toggle-btn { display: none; }
  #minimap-btn { display: none; }
  #grid-btn { display: none; }

  #top-bar { padding: 0 6px; gap: 2px; }

  .logo-wrap { gap: 4px; padding: 0 6px 0 2px; margin-right: 2px; border-right: none; }
  .logo-text { display: none; }
  .logo-icon { width: 26px; height: 26px; border-radius: var(--radius-sm); }
  .logo-icon svg { width: 13px; height: 13px; }

  .vdiv { margin: 0 2px; height: 16px; }
  .tbtn { width: 30px; height: 30px; }
  .tbtn svg { width: 14px; height: 14px; }

  #page-indicator { display: none; }
  #zoom-indicator { font-size: 9px; padding: 2px 6px; }

  /* Hide desktop left toolbar entirely */
  #left-toolbar { display: none; }

  .tip { display: none; }

  #pages-panel {
    bottom: 10px;
    max-width: calc(100vw - 16px);
    left: 50%;
    padding-bottom: calc(5px + env(safe-area-inset-bottom, 0));
  }
  .page-thumb { width: 46px; height: 30px; }
  .page-add-btn { width: 28px; height: 30px; font-size: 15px; }

  #zoom-bar {
    left: 10px; bottom: 10px;
    padding: 2px;
    padding-bottom: calc(2px + env(safe-area-inset-bottom, 0));
  }
  .zbtn { width: 28px; height: 28px; }
  .zbtn svg { width: 13px; height: 13px; }
  #zoom-label { font-size: 10px; min-width: 34px; }

  #stroke-options {
    left: 50%; transform: translateX(-50%);
    top: calc(var(--topbar-h) + 8px); bottom: auto;
    width: calc(100vw - 24px);
    max-width: 280px;
    animation: none;
  }

  #color-picker-panel {
    left: 50% !important; top: calc(var(--topbar-h) + 8px) !important;
    bottom: auto; transform: translateX(-50%);
    width: calc(100vw - 24px);
    max-width: 260px;
    animation: none;
  }

  #text-toolbar {
    top: calc(var(--topbar-h) + 6px);
    padding: 4px 8px; gap: 4px;
    max-width: calc(100vw - 12px);
  }
  #text-toolbar select { font-size: 11px; padding: 4px 6px; }
  #text-toolbar input[type=number] { width: 44px; font-size: 11px; padding: 4px; }
  .tt-btn { width: 26px; height: 26px; font-size: 11px; }

  #shape-bar {
    top: calc(var(--topbar-h) + 6px);
    padding: 3px 4px;
    max-width: calc(100vw - 12px);
  }
  .shape-pick { padding: 5px 7px; min-width: 38px; font-size: 8px; }
  .shape-pick svg { width: 18px; height: 18px; }

  #inspector { right: 8px; width: 160px; padding: 10px; top: calc(var(--topbar-h) + 8px); }
  #history-bar {
    width: calc(100vw - 24px); max-width: 320px;
    bottom: 60px;
  }
  #minimap-wrap { bottom: 60px; right: 8px; width: 110px; height: 76px; }

  .text-overlay { min-width: 80px; min-height: 32px; padding: 4px 6px; }
  body.dragover::after { font-size: 16px; }

  #element-overlay #overlay-drag-handle { width: 28px; height: 18px; font-size: 9px; line-height: 18px; top: -22px; }
  #element-overlay #overlay-edit-btn,
  #element-overlay #overlay-delete-btn { width: 20px; height: 18px; font-size: 10px; line-height: 18px; top: -22px; }
  #element-overlay #overlay-edit-btn { right: 24px; }

  #about-modal { padding: 24px 20px; }
  .about-title { font-size: 18px; }
  .about-logo-icon { width: 44px; height: 44px; border-radius: 12px; }
}

/* ═══════════════════════════════════════════
   RESPONSIVE — SMALL MOBILE (<=400px)
═══════════════════════════════════════════ */
@media (max-width: 400px) {
  :root { --topbar-h: 38px; }

  .logo-wrap { display: none; }

  .tbtn { width: 26px; height: 26px; }
  .tbtn svg { width: 12px; height: 12px; }

  #zoom-indicator { display: none; }

  #zoom-bar { padding: 2px; }
  .zbtn { width: 24px; height: 24px; }
  #zoom-label { font-size: 9px; min-width: 26px; }

  #stroke-options { padding: 10px; gap: 10px; }
  .so-size-val { font-size: 10px; }

  #history-bar { padding: 6px 10px; gap: 6px; }

  .shape-pick { padding: 4px 5px; min-width: 34px; font-size: 7.5px; }
  .shape-pick svg { width: 16px; height: 16px; }

  #mobile-sidebar { width: 250px; }
  .ms-btn { padding: 9px 10px; font-size: 13px; gap: 10px; }
  .ms-btn svg { width: 17px; height: 17px; }
}

/* ═══════════════════════════════════════════
   LANDSCAPE PHONE
═══════════════════════════════════════════ */
@media (max-height: 500px) and (max-width: 900px) and (min-width: 601px) {
  :root { --topbar-h: 36px; }

  #left-toolbar {
    left: 0; top: var(--topbar-h); bottom: 0;
    width: var(--toolbar-w); height: auto;
    flex-direction: column;
    border-right: 1px solid var(--border); border-top: none;
    overflow-y: auto; overflow-x: hidden;
    justify-content: flex-start;
    padding-bottom: 0;
  }
  .tb-section { flex-direction: column; }
  .tb-sep { width: 22px; height: 1px; margin: 2px 0; }
  .ibtn.active::before {
    left: -5px; top: 50%; bottom: auto;
    transform: translateY(-50%);
    width: 2.5px; height: 16px;
    border-radius: 0 3px 3px 0;
  }

  #pages-panel { bottom: 8px; }
  #zoom-bar { bottom: 8px; left: calc(var(--toolbar-w) + 8px); }
}

/* ═══════════════════════════════════════════
   LARGE DESKTOP (>=1400px)
═══════════════════════════════════════════ */
@media (min-width: 1400px) {
  :root { --toolbar-w: 58px; --topbar-h: 48px; }

  .ibtn { width: 42px; height: 42px; }
  .ibtn svg { width: 19px; height: 19px; }

  .tbtn { width: 36px; height: 36px; }
  .tbtn svg { width: 17px; height: 17px; }

  .logo-icon { width: 30px; height: 30px; }
  .logo-text { font-size: 15px; }

  #page-indicator, #zoom-indicator { font-size: 11px; padding: 5px 10px; }

  .sub-tools { min-width: 200px; }
  .sub-item { padding: 9px 14px; font-size: 13.5px; }

  .shape-pick { padding: 7px 12px; min-width: 54px; font-size: 9.5px; }
  .shape-pick svg { width: 24px; height: 24px; }

  #stroke-options { width: 240px; }
  #color-picker-panel { width: 240px; }
}

/* ═══════════════════════════════════════════
   HIGH DPI
═══════════════════════════════════════════ */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .resize-dot { border-width: 1.5px; }
}
